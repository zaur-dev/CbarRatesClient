@page "/docs"
@using CbarRatesApp.Components;
@using System.Net.Http
@using System.Net.Http.Json
@using CbarRatesApp.Models;
@using FxCore.Models;

@inject HttpClient client

@*<div style="width:20%">
    <ZgChart Id="pie1" Type="@ZgChart.ChartType.Bar"
             Data="@(new[] { "1", "2" })"
             BackgroundColor="@(new[] { "blue","green" })"
             Labels="@(new[] { "Fail","Ok" })">
    </ZgChart>
</div>*@
<div>
    @if (showChart)
    {
        <ZgLineChart Id="MyLineChart" Config="config" />
    }
</div>

@code {
    List<DailyFx> fxList;
    ChartConfig config;
    bool showChart;

    protected override async Task OnInitializedAsync()
    {
        fxList = await client.GetFromJsonAsync<List<DailyFx>>("api/get/range/01-01-2023/01-02-2023");

        List<string> labels = new();
        List<string> data = new();
        List<List<string>> datasets = new();

        foreach (var item in fxList)
        {
            labels.Add(item.Date.ToString("d"));
            data.Add(item.Rates.Where(x => x.Code == "EUR").First().Value.ToString());

        }

        datasets.Add(data);


        config = new ChartConfig();

        config.Type = ChartType.line.ToString();
        config.Data = new Data();
        config.Data.Labels = labels.ToArray();

        config.Data.Datasets = new Dataset[datasets.Count];
        for (int i = 0; i < datasets.Count; i++)
        {
            config.Data.Datasets[i] = new Dataset()
                {
                    Label = "My data label",
                    Data = datasets.ElementAt(i).ToArray()
                };

        }


        showChart = true;
    }
}
