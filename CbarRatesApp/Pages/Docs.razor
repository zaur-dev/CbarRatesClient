@page "/docs"
@using CbarRatesApp.Components;
@using System.Net.Http
@using System.Net.Http.Json
@using CbarRatesApp.Models;
@using FxCore.Models;

@inject HttpClient client

@*<div style="width:20%">
    <ZgChart Id="pie1" Type="@ZgChart.ChartType.Bar"
             Data="@(new[] { "1", "2" })"
             BackgroundColor="@(new[] { "blue","green" })"
             Labels="@(new[] { "Fail","Ok" })">
    </ZgChart>
</div>*@
<div>
    @if (showChart)
    {
        <ZgLineChart Id="MyLineChart" Config="config" />
    }
</div>

@code {
    List<DailyFx> fxList;
    ChartConfig config;
    bool showChart;

    protected override async Task OnInitializedAsync()
    {
        fxList = await client.GetFromJsonAsync<List<DailyFx>>("api/get/range/01-01-2023/31-01-2023");

        var data = new DataItem[fxList.Count];
        for (int i = 0; i < fxList.Count; i++)
        {
            data[i] = new DataItem()
                {
                    y = fxList[i].Rates.Where(x => x.Code == "EUR").First().Value.ToString(),
                    x = fxList[i].Date.ToString("d")
                };
        }

        var dataset = new Dataset()
            {
                Label = "EUR",
                Data = data
            };

        config = new ChartConfig()
            {
                Type = ChartType.line.ToString(),
                Data = new Data() { Datasets = new Dataset[1] }
            };

        config.Data.Datasets[0] = dataset;


        showChart = true;
    }
}
